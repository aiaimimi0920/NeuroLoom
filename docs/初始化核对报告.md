# 初始化项目核对报告（基于 `docs/架构.md`）

> 核对范围：当前仓库目录结构、Workspace 配置、各 crate 模块骨架与应用入口。

## 结论（TL;DR）

当前初始化项目**方向正确、骨架基本齐全**，已经覆盖了架构文档定义的核心工作区与 crate 划分；
但仍存在若干“命名/结构未完全对齐”与“Phase 1 可运行性验证受限”的问题，需要在下一步迭代补齐。

## 一、与架构文档一致的部分

- 已采用 Cargo Workspace，多应用（`apps/daemon`、`apps/desktop`、`apps/cli`）+ 多 crate（`nl_core` ~ `nl_hap`）的拆分方案。
- 8 个核心 crate 均已创建并具备基础 `lib.rs` 导出。
- `apps/daemon` 已具备后端初始化主流程（事件存储、Actor Mesh、令牌桶、认知引擎、沙箱、HAP）的串联骨架。

## 二、当前偏差与风险

1. **Workspace 依赖继承配置错误（已修复）**
   - 现象：子 crate 使用 `tokio-test.workspace = true`，但根 `Cargo.toml` 原先写在 `[workspace.dev-dependencies]`，导致 Cargo 解析失败。
   - 影响：`cargo check` 在解析 manifest 阶段即失败，无法进行初始化健康检查。
   - 处理：已将 `tokio-test` 与 `criterion` 放入 `[workspace.dependencies]` 以支持继承。

2. **模块落盘形态与架构蓝图不完全一致（待后续）**
   - 文档蓝图中部分模块是“目录+子文件”形态（如 `system1/sop_engine.rs`、`system2/mcts.rs`、`micro_vm/firecracker.rs`），当前为扁平文件（如 `system1.rs`、`system2.rs`、`micro_vm.rs`）。
   - 影响：语义上可工作，但不利于后续按文档扩展子模块。

3. **桌面端仍为占位骨架（待后续）**
   - 当前 `apps/desktop` 主程序仅保留启动日志与 TODO，尚未接入 Tauri 与空间画布能力。

4. **Phase 1 编译验证受外网限制**
   - `cargo check` 继续执行时，因 crates.io 访问返回 403 导致依赖下载失败。
   - 影响：本次无法完成“全仓可编译”结论，只能完成静态结构核对。

## 三、建议的下一步（按优先级）

1. 先在可联网或已缓存依赖的环境跑通 `cargo check` / `cargo test`，确认骨架真实可编译。
2. 将 `nl_cognitive`、`nl_sandbox`、`nl_llm` 中关键模块按架构文档的目录化形态重构，降低后续冲突。
3. 在 `apps/desktop` 引入最小 Tauri 壳，打通与 `apps/daemon` 的最简通信链路。
4. 建立 `Phase 1` 对应的最小验收脚本（令牌桶并发压测、事件重放恢复测试）。

